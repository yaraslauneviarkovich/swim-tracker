<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swim Meet Tracker - 10 & Under</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            background: transparent;
            font-size: 1em;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            color: #2a5298;
            border-bottom: 3px solid #2a5298;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2a5298;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            color: #2a5298;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #1e3c72;
        }

        .records-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .records-table th,
        .records-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .records-table th {
            background: #2a5298;
            color: white;
            font-weight: 600;
        }

        .records-table tr:hover {
            background: #f5f5f5;
        }

        .standard-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            color: white;
        }

        .standard-B { background: #95a5a6; }
        .standard-BB { background: #3498db; }
        .standard-A { background: #2ecc71; }
        .standard-AA { background: #f39c12; }
        .standard-AAA { background: #e74c3c; }
        .standard-AAAA { background: #9b59b6; }

        .swim-entry {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .swim-entry-info {
            flex: 1;
        }

        .swim-entry-info strong {
            color: #2a5298;
            display: block;
            margin-bottom: 5px;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .delete-btn:hover {
            background: #c0392b;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .filter-controls {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-controls select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèä‚Äç‚ôÇÔ∏è Swim Meet Tracker</h1>
            <p>10 & Under | USA Swimming Standards 2024-2028</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('entry')">Add Swim</button>
            <button class="tab" onclick="switchTab('bulk')">Bulk Import</button>
            <button class="tab" onclick="switchTab('progress')">Progress Charts</button>
            <button class="tab" onclick="switchTab('records')">Personal Records</button>
            <button class="tab" onclick="switchTab('standards')">Standards Comparison</button>
            <button class="tab" onclick="switchTab('history')">Swim History</button>
        </div>

        <!-- Bulk Import Tab -->
        <div id="bulk" class="tab-content">
            <h2 style="margin-bottom: 20px;">Bulk Import from Text</h2>
            <p style="color: #666; margin-bottom: 20px;">
                Paste your swim meet results and we'll automatically parse them. Format example:
            </p>
            <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-family: monospace; font-size: 0.9em;">
                Short course (Addison, 7 Feb 2026)<br>
                50y Fly: 55.73 - last 58.39<br>
                100y free: 1:36.26 - last 1:41.68<br>
                100y IM: 1:44.76 - last 1:46.40
            </div>
            
            <form id="bulkForm">
                <div class="form-group">
                    <label for="bulkText">Paste Meet Results</label>
                    <textarea id="bulkText" rows="12" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-family: monospace; font-size: 0.95em;" placeholder="Paste your meet results here..."></textarea>
                </div>
                
                <div id="bulkPreview" style="display: none; margin: 20px 0; padding: 20px; background: #e8f5e9; border-radius: 8px; border: 2px solid #4caf50;">
                    <h3 style="color: #2e7d32; margin-bottom: 15px;">Preview - Found <span id="previewCount">0</span> swims:</h3>
                    <div id="previewContent"></div>
                </div>
                
                <div style="display: flex; gap: 15px;">
                    <button type="button" class="btn" onclick="previewBulkImport()" style="flex: 1;">Preview Import</button>
                    <button type="submit" class="btn" style="flex: 1; background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);">Import All</button>
                </div>
            </form>
        </div>

        <!-- Entry Tab -->
        <div id="entry" class="tab-content active">
            <h2 style="margin-bottom: 20px;">Add New Swim Time</h2>
            <form id="swimForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="meetDate">Meet Date</label>
                        <input type="date" id="meetDate" required>
                    </div>
                    <div class="form-group">
                        <label for="meetName">Meet Name</label>
                        <input type="text" id="meetName" placeholder="e.g., Winter Championships" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="course">Course</label>
                        <select id="course" required>
                            <option value="">Select Course</option>
                            <option value="SCY">SCY (Short Course Yards)</option>
                            <option value="LCM">LCM (Long Course Meters)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="event">Event</label>
                        <select id="event" required>
                            <option value="">Select Event</option>
                            <option value="50 Free">50 Free</option>
                            <option value="100 Free">100 Free</option>
                            <option value="200 Free">200 Free</option>
                            <option value="400 Free">400 Free</option>
                            <option value="800 Free">800 Free</option>
                            <option value="50 Back">50 Back</option>
                            <option value="100 Back">100 Back</option>
                            <option value="200 Back">200 Back</option>
                            <option value="50 Breast">50 Breast</option>
                            <option value="100 Breast">100 Breast</option>
                            <option value="200 Breast">200 Breast</option>
                            <option value="50 Fly">50 Fly</option>
                            <option value="100 Fly">100 Fly</option>
                            <option value="200 Fly">200 Fly</option>
                            <option value="100 IM">100 IM</option>
                            <option value="200 IM">200 IM</option>
                            <option value="400 IM">400 IM</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Time Entry Method</label>
                    <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="radio" name="timeMethod" value="separate" checked onchange="toggleTimeInput()">
                            <span>Separate Fields</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="radio" name="timeMethod" value="freeform" onchange="toggleTimeInput()">
                            <span>Free-form Text</span>
                        </label>
                    </div>
                </div>

                <div id="separateFields" class="form-row">
                    <div class="form-group">
                        <label for="minutes">Minutes</label>
                        <input type="number" id="minutes" min="0" max="59" value="0">
                    </div>
                    <div class="form-group">
                        <label for="seconds">Seconds</label>
                        <input type="number" id="seconds" min="0" max="59" value="0">
                    </div>
                    <div class="form-group">
                        <label for="milliseconds">Hundredths (00-99)</label>
                        <input type="number" id="milliseconds" min="0" max="99" value="0">
                    </div>
                </div>

                <div id="freeformField" class="form-group" style="display: none;">
                    <label for="freeformTime">Free-Form Entry (Single or Multiple Swims)</label>
                    <textarea id="freeformTime" rows="8" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-family: monospace; font-size: 0.95em;" placeholder="Enter one or more swims..."></textarea>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        <strong>Single swim:</strong> 50y Fly 55.73 Addison 7 Feb 2026<br>
                        <strong>Multiple swims:</strong><br>
                        SCY 25ft (Addison, 7 Feb 2026):<br>
                        50y Fly: 55.73 - last 58.39<br>
                        100y free: 1:36.26 - last 1:41.68
                    </small>
                </div>

                <button type="submit" class="btn">Add Swim Time</button>
            </form>
        </div>

        <!-- Progress Tab -->
        <div id="progress" class="tab-content">
            <h2 style="margin-bottom: 20px;">Progress Over Time</h2>
            <div class="filter-controls">
                <select id="progressEvent" onchange="updateProgressCharts()">
                    <option value="">All Events</option>
                </select>
                <select id="progressCourse" onchange="updateProgressCharts()">
                    <option value="">All Courses</option>
                    <option value="SCY">SCY Only</option>
                    <option value="LCM">LCM Only</option>
                </select>
            </div>
            <div class="chart-container">
                <canvas id="progressChart"></canvas>
            </div>
            <h3 style="margin-top: 30px; margin-bottom: 20px;">Speed Analysis (meters per second)</h3>
            <div class="chart-container">
                <canvas id="speedChart"></canvas>
            </div>
        </div>

        <!-- Records Tab -->
        <div id="records" class="tab-content">
            <h2 style="margin-bottom: 20px;">Personal Records</h2>
            <div class="filter-controls">
                <select id="recordsCourse" onchange="updateRecords()">
                    <option value="">All Courses</option>
                    <option value="SCY">SCY Only</option>
                    <option value="LCM">LCM Only</option>
                </select>
            </div>
            <table class="records-table">
                <thead>
                    <tr>
                        <th>Event</th>
                        <th>Course</th>
                        <th>Best Time</th>
                        <th>Standard</th>
                        <th>Meet</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="recordsBody">
                </tbody>
            </table>
        </div>

        <!-- Standards Tab -->
        <div id="standards" class="tab-content">
            <h2 style="margin-bottom: 20px;">Standards Comparison</h2>
            <div class="filter-controls">
                <select id="standardsEvent" onchange="updateStandards()">
                    <option value="">Select Event</option>
                </select>
                <select id="standardsCourse" onchange="updateStandards()">
                    <option value="">Select Course</option>
                    <option value="SCY">SCY</option>
                    <option value="LCM">LCM</option>
                </select>
            </div>
            <div id="standardsContent"></div>
        </div>

        <!-- History Tab -->
        <div id="history" class="tab-content">
            <h2 style="margin-bottom: 20px;">All Swim Times</h2>
            <div class="filter-controls">
                <select id="historyEvent" onchange="updateHistory()">
                    <option value="">All Events</option>
                </select>
                <select id="historyCourse" onchange="updateHistory()">
                    <option value="">All Courses</option>
                    <option value="SCY">SCY Only</option>
                    <option value="LCM">LCM Only</option>
                </select>
            </div>
            <div id="historyContent"></div>
        </div>
    </div>

    <script>
        // USA Swimming 2024-2028 Motivational Standards for 10 & Under Boys
        const STANDARDS = {
            "SCY": {
                "50 Free": { "AAAA": 27.49, "AAA": 28.69, "AA": 29.89, "A": 31.09, "BB": 34.59, "B": 38.19 },
                "100 Free": { "AAAA": 60.69, "AAA": 63.79, "AA": 66.79, "A": 69.79, "BB": 78.89, "B": 87.99 },
                "200 Free": { "AAAA": 132.69, "AAA": 138.99, "AA": 145.29, "A": 151.59, "BB": 170.59, "B": 189.49 },
                "500 Free": { "AAAA": 352.99, "AAA": 369.79, "AA": 386.59, "A": 403.39, "BB": 453.79, "B": 504.29 },
                "1000 Free": { "AAAA": 662.59, "AAA": 694.19, "AA": 725.79, "A": 757.29, "BB": 840.39, "B": 923.49 },
                "50 Back": { "AAAA": 32.19, "AAA": 33.99, "AA": 35.79, "A": 37.59, "BB": 42.89, "B": 48.29 },
                "100 Back": { "AAAA": 68.99, "AAA": 72.49, "AA": 76.09, "A": 79.59, "BB": 90.09, "B": 100.69 },
                "200 Back": { "AAAA": 149.69, "AAA": 155.89, "AA": 161.99, "A": 168.19, "BB": 180.49, "B": 192.89 },
                "50 Breast": { "AAAA": 36.39, "AAA": 38.29, "AA": 40.19, "A": 42.09, "BB": 47.69, "B": 53.39 },
                "100 Breast": { "AAAA": 78.79, "AAA": 82.69, "AA": 86.59, "A": 90.59, "BB": 102.29, "B": 114.09 },
                "200 Breast": { "AAAA": 167.29, "AAA": 174.39, "AA": 181.39, "A": 188.39, "BB": 202.39, "B": 216.39 },
                "50 Fly": { "AAAA": 30.79, "AAA": 32.59, "AA": 34.29, "A": 35.99, "BB": 41.29, "B": 46.49 },
                "100 Fly": { "AAAA": 69.79, "AAA": 74.59, "AA": 79.49, "A": 84.39, "BB": 98.99, "B": 113.49 },
                "200 Fly": { "AAAA": 152.39, "AAA": 158.69, "AA": 164.99, "A": 171.39, "BB": 183.99, "B": 196.59 },
                "100 IM": { "AAAA": 69.79, "AAA": 73.09, "AA": 76.39, "A": 79.69, "BB": 89.69, "B": 99.69 },
                "200 IM": { "AAAA": 150.89, "AAA": 158.39, "AA": 165.89, "A": 173.49, "BB": 195.99, "B": 218.59 },
                "400 IM": { "AAAA": 322.79, "AAA": 336.29, "AA": 349.79, "A": 363.19, "BB": 390.09, "B": 417.09 }
            },
            "LCM": {
                "50 Free": { "AAAA": 31.59, "AAA": 32.99, "AA": 34.39, "A": 35.69, "BB": 39.79, "B": 43.89 },
                "100 Free": { "AAAA": 69.79, "AAA": 73.19, "AA": 76.69, "A": 80.19, "BB": 90.59, "B": 100.99 },
                "200 Free": { "AAAA": 151.69, "AAA": 158.89, "AA": 166.09, "A": 173.39, "BB": 194.99, "B": 216.69 },
                "400 Free": { "AAAA": 320.79, "AAA": 336.09, "AA": 351.39, "A": 366.59, "BB": 412.49, "B": 458.29 },
                "800 Free": { "AAAA": 660.09, "AAA": 688.69, "AA": 717.29, "A": 745.89, "BB": 822.99, "B": 900.19 },
                "1500 Free": { "AAAA": 1163.89, "AAA": 1219.29, "AA": 1274.69, "A": 1330.19, "BB": 1480.99, "B": 1631.79 },
                "50 Back": { "AAAA": 36.99, "AAA": 38.99, "AA": 41.09, "A": 43.09, "BB": 49.29, "B": 55.39 },
                "100 Back": { "AAAA": 79.99, "AAA": 84.09, "AA": 88.19, "A": 92.29, "BB": 104.49, "B": 116.69 },
                "200 Back": { "AAAA": 172.19, "AAA": 179.49, "AA": 186.69, "A": 193.99, "BB": 208.49, "B": 222.99 },
                "50 Breast": { "AAAA": 41.49, "AAA": 43.59, "AA": 45.79, "A": 47.89, "BB": 54.39, "B": 60.89 },
                "100 Breast": { "AAAA": 91.69, "AAA": 96.29, "AA": 100.89, "A": 105.49, "BB": 119.19, "B": 132.89 },
                "200 Breast": { "AAAA": 190.99, "AAA": 199.09, "AA": 207.19, "A": 215.39, "BB": 231.59, "B": 247.89 },
                "50 Fly": { "AAAA": 34.69, "AAA": 36.59, "AA": 38.59, "A": 40.59, "BB": 46.39, "B": 52.29 },
                "100 Fly": { "AAAA": 79.59, "AAA": 85.09, "AA": 90.69, "A": 96.19, "BB": 112.89, "B": 129.49 },
                "200 Fly": { "AAAA": 173.59, "AAA": 180.89, "AA": 188.29, "A": 195.59, "BB": 210.19, "B": 224.79 },
                "200 IM": { "AAAA": 172.19, "AAA": 180.79, "AA": 189.39, "A": 197.89, "BB": 223.69, "B": 249.49 },
                "400 IM": { "AAAA": 368.39, "AAA": 384.09, "AA": 399.69, "A": 415.39, "BB": 446.59, "B": 477.89 }
            }
        };

        let swims = JSON.parse(localStorage.getItem('swimData')) || [];
        let progressChart = null;
        let speedChart = null;
        let bulkParsedSwims = [];

        // Bulk import parser
        function parseBulkText(text) {
            const lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
            const swims = [];
            let currentMeet = { name: '', date: '', course: '' };
            
            for (let line of lines) {
                // Remove trailing commas
                line = line.replace(/,\s*$/, '');
                
                // Check for course/meet line with multiple formats:
                // Format 1: "Short course (Addison, 7 Feb 2026)"
                // Format 2: "SCY 25ft (Addison, 7 Feb 2026):"
                // Format 3: "SCY 25ft (Addison, 7 Feb 2026)" (no colon)
                // Format 4: "LCM (Addison, 7 Feb 2026)"
                
                const meetMatch1 = line.match(/(short\s+course|long\s+course)\s*\(([^,]+),\s*(.+?)\):?/i);
                const meetMatch2 = line.match(/(SCY|LCM)\s*(?:\d+ft)?\s*\(([^,]+),\s*(.+?)\):?/i);
                
                let meetMatch = meetMatch1 || meetMatch2;
                
                if (meetMatch) {
                    let courseType;
                    if (meetMatch === meetMatch1) {
                        courseType = meetMatch[1].toLowerCase().includes('short') ? 'SCY' : 'LCM';
                    } else {
                        courseType = meetMatch[1].toUpperCase();
                    }
                    
                    const location = meetMatch[2].trim();
                    const dateStr = meetMatch[3].trim().replace(/[:\s]+$/, ''); // Remove trailing colons/spaces
                    
                    currentMeet = {
                        course: courseType,
                        name: location,
                        date: parseDate(dateStr)
                    };
                    continue;
                }
                
                // Parse swim line in clean format: "50y Fly: 55:73,"
                // No "last", no "DQ", no extra dashes - just event and time
                
                // Match event line - simple format
                const swimMatch = line.match(/(\d+)([ym])\s+(free|fly|back|breast|im)[:\s]+(.+)$/i);
                if (swimMatch) {
                    const distance = swimMatch[1];
                    const unit = swimMatch[2].toLowerCase();
                    const stroke = swimMatch[3];
                    let timeStr = swimMatch[4].trim();
                    
                    // Only process if it's yards (y) or meters (m) matching our course
                    const expectedUnit = currentMeet.course === 'SCY' ? 'y' : 'm';
                    if (unit !== expectedUnit) continue;
                    
                    // Clean up the time string - remove any spaces within the time
                    // Handle cases like "1: 44.76" -> "1:44.76"
                    timeStr = timeStr.replace(/\s+/g, '');
                    
                    const time = parseFreeformTime(timeStr);
                    if (time === null) continue;
                    
                    // Build event name
                    const eventName = `${distance} ${stroke.charAt(0).toUpperCase() + stroke.slice(1)}`;
                    
                    swims.push({
                        date: currentMeet.date,
                        meetName: currentMeet.name,
                        course: currentMeet.course,
                        event: eventName,
                        time: time
                    });
                }
            }
            
            return swims;
        }
        
        function parseDate(dateStr) {
            // Parse "7 Feb 2026" format
            const months = {
                'jan': 0, 'feb': 1, 'mar': 2, 'apr': 3, 'may': 4, 'jun': 5,
                'jul': 6, 'aug': 7, 'sep': 8, 'oct': 9, 'nov': 10, 'dec': 11
            };
            
            const match = dateStr.match(/(\d+)\s+([a-z]+)\s+(\d{4})/i);
            if (match) {
                const day = parseInt(match[1]);
                const monthStr = match[2].toLowerCase().substring(0, 3);
                const year = parseInt(match[3]);
                const month = months[monthStr];
                
                if (month !== undefined) {
                    const date = new Date(year, month, day);
                    return date.toISOString().split('T')[0];
                }
            }
            
            // Fallback to today's date
            return new Date().toISOString().split('T')[0];
        }
        
        function previewBulkImport() {
            const text = document.getElementById('bulkText').value;
            bulkParsedSwims = parseBulkText(text);
            
            const preview = document.getElementById('bulkPreview');
            const count = document.getElementById('previewCount');
            const content = document.getElementById('previewContent');
            
            if (bulkParsedSwims.length === 0) {
                alert('No valid swim times found. Please check the format.');
                preview.style.display = 'none';
                return;
            }
            
            count.textContent = bulkParsedSwims.length;
            content.innerHTML = bulkParsedSwims.map((swim, idx) => `
                <div style="background: white; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid #4caf50;">
                    <strong>${idx + 1}. ${swim.event} (${swim.course})</strong><br>
                    <span style="color: #666;">Time: ${formatTime(swim.time)} | ${swim.meetName} | ${new Date(swim.date).toLocaleDateString()}</span>
                </div>
            `).join('');
            
            preview.style.display = 'block';
        }
        
        document.getElementById('bulkForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (bulkParsedSwims.length === 0) {
                alert('Please preview the import first!');
                return;
            }
            
            // Add all parsed swims
            bulkParsedSwims.forEach(swim => {
                swims.push({
                    id: Date.now() + Math.random(), // Unique ID
                    ...swim
                });
            });
            
            localStorage.setItem('swimData', JSON.stringify(swims));
            
            // Reset form
            document.getElementById('bulkText').value = '';
            document.getElementById('bulkPreview').style.display = 'none';
            bulkParsedSwims = [];
            
            alert(`Successfully imported ${bulkParsedSwims.length} swim times!`);
            populateEventFilters();
            updateProgressCharts();
            updateRecords();
            updateHistory();
        });

        // Toggle between separate fields and free-form input
        function toggleTimeInput() {
            const method = document.querySelector('input[name="timeMethod"]:checked').value;
            const separateFields = document.getElementById('separateFields');
            const freeformField = document.getElementById('freeformField');
            
            if (method === 'freeform') {
                separateFields.style.display = 'none';
                freeformField.style.display = 'block';
                // Remove required from separate fields
                document.getElementById('minutes').removeAttribute('required');
                document.getElementById('seconds').removeAttribute('required');
                document.getElementById('milliseconds').removeAttribute('required');
                // Add required to freeform
                document.getElementById('freeformTime').setAttribute('required', 'required');
            } else {
                separateFields.style.display = 'grid';
                freeformField.style.display = 'none';
                // Add required to separate fields
                document.getElementById('minutes').setAttribute('required', 'required');
                document.getElementById('seconds').setAttribute('required', 'required');
                document.getElementById('milliseconds').setAttribute('required', 'required');
                // Remove required from freeform
                document.getElementById('freeformTime').removeAttribute('required');
            }
        }

        // Parse complete free-form entry with all details
        function parseCompleteFreeformEntry(input) {
            // Format: "50y Fly 55.73 Addison 7 Feb 2026"
            // Pattern: [distance][y/m] [stroke] [time] [meet name] [date]
            
            input = input.trim();
            
            // Extract distance and unit: 50y, 100m, etc.
            const distanceMatch = input.match(/^(\d+)([ym])\s+/i);
            if (!distanceMatch) return null;
            
            const distance = distanceMatch[1];
            const unit = distanceMatch[2].toLowerCase();
            const course = unit === 'y' ? 'SCY' : 'LCM';
            
            // Remove distance from input
            input = input.substring(distanceMatch[0].length).trim();
            
            // Extract stroke (free, fly, back, breast, im)
            const strokeMatch = input.match(/^(free|fly|back|breast|im)\s+/i);
            if (!strokeMatch) return null;
            
            const stroke = strokeMatch[1];
            const eventName = `${distance} ${stroke.charAt(0).toUpperCase() + stroke.slice(1)}`;
            
            // Remove stroke from input
            input = input.substring(strokeMatch[0].length).trim();
            
            // Extract time (first thing that looks like a time)
            const timeMatch = input.match(/^([\d:.,]+)\s+/);
            if (!timeMatch) return null;
            
            const timeStr = timeMatch[1];
            const time = parseFreeformTime(timeStr);
            if (time === null) return null;
            
            // Remove time from input
            input = input.substring(timeMatch[0].length).trim();
            
            // What's left should be: "Addison 7 Feb 2026" or "Winter Champs 15 Jan 2026"
            // Try to find date pattern at the end
            const dateMatch = input.match(/(\d{1,2}\s+[a-z]+\s+\d{4})$/i);
            let meetName = input;
            let date = new Date().toISOString().split('T')[0]; // Default to today
            
            if (dateMatch) {
                date = parseDate(dateMatch[1]);
                // Meet name is everything before the date
                meetName = input.substring(0, dateMatch.index).trim();
            }
            
            // If no meet name provided, use a default
            if (!meetName) {
                meetName = 'Unnamed Meet';
            }
            
            return {
                course: course,
                event: eventName,
                time: time,
                meetName: meetName,
                date: date
            };
        }

        // Parse free-form time input
        function parseFreeformTime(input) {
            // Remove whitespace
            input = input.trim();
            
            // Replace commas with periods (some countries use commas for decimals)
            input = input.replace(',', '.');
            
            let minutes = 0;
            let seconds = 0;
            let hundredths = 0;
            
            // Pattern 1: mm:ss.ms or mm:ss:ms (e.g., 1:23.45 or 1:23:45)
            const pattern1 = /^(\d+)[:.](\d+)[:\.](\d+)$/;
            // Pattern 2: ss.ms or ss:ms (e.g., 32.18 or 32:18 - could be 32.18 sec OR 32 min 18 sec)
            const pattern2 = /^(\d+)[:\.](\d+)$/;
            // Pattern 3: mm:ss (e.g., 1:23)
            const pattern3 = /^(\d+):(\d+)$/;
            
            let match;
            
            if (match = input.match(pattern1)) {
                // mm:ss.ms or mm:ss:ms
                minutes = parseInt(match[1]);
                seconds = parseInt(match[2]);
                hundredths = parseInt(match[3]);
                
                // Handle if third part is meant to be milliseconds (3 digits)
                if (match[3].length === 3) {
                    hundredths = Math.round(parseInt(match[3]) / 10);
                } else if (match[3].length === 1) {
                    // Single digit - multiply by 10
                    hundredths = parseInt(match[3]) * 10;
                }
            } else if (match = input.match(pattern2)) {
                // ss.ms or ss:ms
                const firstNum = parseInt(match[1]);
                const secondNum = parseInt(match[2]);
                
                // Determine if it's mm:ss or ss.ms based on context
                // If second number is < 60 and first number is < 10, likely ss.ms
                // If second number is >= 60 or first number >= 10, likely mm:ss
                if (secondNum >= 60 || (firstNum >= 10 && secondNum < 60)) {
                    // Treat as mm:ss
                    minutes = firstNum;
                    seconds = secondNum;
                    hundredths = 0;
                } else {
                    // Treat as ss.ms
                    seconds = firstNum;
                    const decimal = match[2];
                    
                    // Handle different decimal lengths
                    if (decimal.length === 1) {
                        hundredths = parseInt(decimal) * 10;
                    } else if (decimal.length === 2) {
                        hundredths = parseInt(decimal);
                    } else if (decimal.length === 3) {
                        hundredths = Math.round(parseInt(decimal) / 10);
                    }
                }
            } else if (match = input.match(pattern3)) {
                // mm:ss (already handled by pattern2, but keep for clarity)
                minutes = parseInt(match[1]);
                seconds = parseInt(match[2]);
                hundredths = 0;
            } else {
                // Try parsing as plain seconds
                const plainSeconds = parseFloat(input);
                if (!isNaN(plainSeconds)) {
                    minutes = Math.floor(plainSeconds / 60);
                    const remainingSeconds = plainSeconds % 60;
                    seconds = Math.floor(remainingSeconds);
                    hundredths = Math.round((remainingSeconds - seconds) * 100);
                } else {
                    return null; // Invalid format
                }
            }
            
            // Validate ranges
            if (seconds >= 60 || hundredths >= 100 || minutes < 0 || seconds < 0 || hundredths < 0) {
                return null;
            }
            
            // Convert to total seconds
            return minutes * 60 + seconds + (hundredths / 100);
        }

        // Initialize
        document.getElementById('meetDate').valueAsDate = new Date();
        populateEventFilters();
        updateProgressCharts();
        updateRecords();
        updateHistory();

        // Form submission
        document.getElementById('swimForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const method = document.querySelector('input[name="timeMethod"]:checked').value;
            let newSwims = [];
            
            if (method === 'freeform') {
                const freeformInput = document.getElementById('freeformTime').value.trim();
                
                // Check if it's multi-line (contains newlines)
                if (freeformInput.includes('\n')) {
                    // Use bulk parser
                    newSwims = parseBulkText(freeformInput);
                    if (newSwims.length === 0) {
                        alert('Invalid format! Please check the examples.');
                        return;
                    }
                } else {
                    // Single line entry
                    const parsed = parseCompleteFreeformEntry(freeformInput);
                    if (parsed === null) {
                        alert('Invalid format! Please use:\n[distance][y/m] [stroke] [time] [meet name] [date]\n\nExample:\n50y Fly 55.73 Addison 7 Feb 2026');
                        return;
                    }
                    newSwims = [parsed];
                }
                
                // Add all parsed swims
                newSwims.forEach(swim => {
                    swims.push({
                        id: Date.now() + Math.random(),
                        ...swim
                    });
                });
                
            } else {
                // Separate fields method
                const minutes = parseInt(document.getElementById('minutes').value);
                const seconds = parseInt(document.getElementById('seconds').value);
                const hundredths = parseInt(document.getElementById('milliseconds').value);
                const totalSeconds = minutes * 60 + seconds + (hundredths / 100);
                
                const swim = {
                    id: Date.now(),
                    date: document.getElementById('meetDate').value,
                    meetName: document.getElementById('meetName').value,
                    course: document.getElementById('course').value,
                    event: document.getElementById('event').value,
                    time: totalSeconds
                };
                
                swims.push(swim);
            }
            
            localStorage.setItem('swimData', JSON.stringify(swims));
            
            this.reset();
            document.getElementById('meetDate').valueAsDate = new Date();
            document.getElementById('minutes').value = '0';
            document.getElementById('seconds').value = '0';
            document.getElementById('milliseconds').value = '0';
            
            const count = method === 'freeform' && newSwims.length > 1 ? `${newSwims.length} swim times` : 'Swim time';
            alert(`${count} added successfully!`);
            populateEventFilters();
            updateProgressCharts();
            updateRecords();
            updateHistory();
        });

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'progress') updateProgressCharts();
            if (tabName === 'records') updateRecords();
            if (tabName === 'standards') updateStandards();
            if (tabName === 'history') updateHistory();
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = (seconds % 60).toFixed(2);
            return mins > 0 ? `${mins}:${secs.padStart(5, '0')}` : `${secs}`;
        }

        function getStandard(course, event, time) {
            const standards = STANDARDS[course]?.[event];
            if (!standards) return null;
            
            if (time <= standards.AAAA) return 'AAAA';
            if (time <= standards.AAA) return 'AAA';
            if (time <= standards.AA) return 'AA';
            if (time <= standards.A) return 'A';
            if (time <= standards.BB) return 'BB';
            if (time <= standards.B) return 'B';
            return null;
        }

        function getNextStandard(course, event, time) {
            const standards = STANDARDS[course]?.[event];
            if (!standards) return null;
            
            const levels = ['B', 'BB', 'A', 'AA', 'AAA', 'AAAA'];
            for (let level of levels) {
                if (time > standards[level]) {
                    return { level, time: standards[level], improvement: time - standards[level] };
                }
            }
            return null;
        }

        function populateEventFilters() {
            const events = [...new Set(swims.map(s => s.event))].sort();
            
            ['progressEvent', 'historyEvent', 'standardsEvent'].forEach(id => {
                const select = document.getElementById(id);
                const currentValue = select.value;
                select.innerHTML = '<option value="">All Events</option>';
                events.forEach(event => {
                    select.innerHTML += `<option value="${event}">${event}</option>`;
                });
                select.value = currentValue;
            });
        }

        function updateProgressCharts() {
            const eventFilter = document.getElementById('progressEvent').value;
            const courseFilter = document.getElementById('progressCourse').value;
            
            let filteredSwims = swims.filter(s => {
                return (!eventFilter || s.event === eventFilter) &&
                       (!courseFilter || s.course === courseFilter);
            });
            
            filteredSwims.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            const ctx1 = document.getElementById('progressChart').getContext('2d');
            const ctx2 = document.getElementById('speedChart').getContext('2d');
            
            if (progressChart) progressChart.destroy();
            if (speedChart) speedChart.destroy();
            
            if (filteredSwims.length === 0) {
                // Show empty state message
                ctx1.canvas.style.display = 'none';
                ctx2.canvas.style.display = 'none';
                
                const container1 = ctx1.canvas.parentElement;
                const container2 = ctx2.canvas.parentElement;
                
                if (!document.getElementById('emptyProgress')) {
                    const emptyDiv = document.createElement('div');
                    emptyDiv.id = 'emptyProgress';
                    emptyDiv.className = 'empty-state';
                    emptyDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 60px 20px;">No swim data to display. Add some swim times to see your progress!</p>';
                    container1.appendChild(emptyDiv);
                }
                return;
            }
            
            // Remove empty state if it exists
            const emptyState = document.getElementById('emptyProgress');
            if (emptyState) emptyState.remove();
            
            ctx1.canvas.style.display = 'block';
            ctx2.canvas.style.display = 'block';
            
            // Group by event for multiple lines
            const eventGroups = {};
            filteredSwims.forEach(swim => {
                const key = `${swim.event} (${swim.course})`;
                if (!eventGroups[key]) eventGroups[key] = [];
                eventGroups[key].push(swim);
            });
            
            const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b', '#fa709a'];
            
            const datasets = Object.keys(eventGroups).map((key, idx) => ({
                label: key,
                data: eventGroups[key].map(s => ({ x: s.date, y: s.time })),
                borderColor: colors[idx % colors.length],
                backgroundColor: colors[idx % colors.length] + '33',
                tension: 0.4,
                fill: false
            }));
            
            progressChart = new Chart(ctx1, {
                type: 'line',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Time Progress (Lower is Better)', font: { size: 16 } },
                        legend: { display: true }
                    },
                    scales: {
                        x: { type: 'time', time: { unit: 'day' }, title: { display: true, text: 'Date' } },
                        y: { 
                            reverse: true,
                            title: { display: true, text: 'Time (seconds)' },
                            ticks: { callback: value => formatTime(value) }
                        }
                    }
                }
            });
            
            // Speed chart
            const speedDatasets = Object.keys(eventGroups).map((key, idx) => {
                const event = eventGroups[key][0].event;
                const distance = parseInt(event.split(' ')[0]);
                return {
                    label: key,
                    data: eventGroups[key].map(s => ({ 
                        x: s.date, 
                        y: distance / s.time 
                    })),
                    borderColor: colors[idx % colors.length],
                    backgroundColor: colors[idx % colors.length] + '33',
                    tension: 0.4,
                    fill: false
                };
            });
            
            speedChart = new Chart(ctx2, {
                type: 'line',
                data: { datasets: speedDatasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Speed Progress (Higher is Better)', font: { size: 16 } },
                        legend: { display: true }
                    },
                    scales: {
                        x: { type: 'time', time: { unit: 'day' }, title: { display: true, text: 'Date' } },
                        y: { 
                            title: { display: true, text: 'Speed (m/s)' },
                            ticks: { callback: value => value.toFixed(2) }
                        }
                    }
                }
            });
        }

        function updateRecords() {
            const courseFilter = document.getElementById('recordsCourse').value;
            const tbody = document.getElementById('recordsBody');
            
            let filteredSwims = swims.filter(s => !courseFilter || s.course === courseFilter);
            
            // Get best time for each event/course combo
            const records = {};
            filteredSwims.forEach(swim => {
                const key = `${swim.event}-${swim.course}`;
                if (!records[key] || swim.time < records[key].time) {
                    records[key] = swim;
                }
            });
            
            tbody.innerHTML = '';
            Object.values(records).sort((a, b) => a.event.localeCompare(b.event)).forEach(record => {
                const standard = getStandard(record.course, record.event, record.time);
                const standardBadge = standard ? 
                    `<span class="standard-badge standard-${standard}">${standard}</span>` : 
                    '<span style="color: #999;">No Standard</span>';
                
                tbody.innerHTML += `
                    <tr>
                        <td><strong>${record.event}</strong></td>
                        <td>${record.course}</td>
                        <td><strong>${formatTime(record.time)}</strong></td>
                        <td>${standardBadge}</td>
                        <td>${record.meetName}</td>
                        <td>${new Date(record.date).toLocaleDateString()}</td>
                    </tr>
                `;
            });
            
            if (Object.keys(records).length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: #999;">No records yet. Add some swim times!</td></tr>';
            }
        }

        function updateStandards() {
            const event = document.getElementById('standardsEvent').value;
            const course = document.getElementById('standardsCourse').value;
            const content = document.getElementById('standardsContent');
            
            if (!event || !course) {
                content.innerHTML = '<div class="empty-state"><p>Please select an event and course to view standards comparison.</p></div>';
                return;
            }
            
            const standards = STANDARDS[course][event];
            const personalBest = swims
                .filter(s => s.event === event && s.course === course)
                .sort((a, b) => a.time - b.time)[0];
            
            if (!personalBest) {
                content.innerHTML = '<div class="empty-state"><p>No times recorded for this event yet.</p></div>';
                return;
            }
            
            const currentStandard = getStandard(course, event, personalBest.time);
            const nextStandard = getNextStandard(course, event, personalBest.time);
            
            let html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Your Best Time</h3>
                        <div class="value">${formatTime(personalBest.time)}</div>
                        <p style="margin-top: 10px; color: #666;">${new Date(personalBest.date).toLocaleDateString()}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Current Standard</h3>
                        <div class="value">${currentStandard ? `<span class="standard-badge standard-${currentStandard}">${currentStandard}</span>` : 'None'}</div>
                    </div>
                    ${nextStandard ? `
                    <div class="stat-card">
                        <h3>Next Goal: ${nextStandard.level}</h3>
                        <div class="value">${formatTime(nextStandard.time)}</div>
                        <p style="margin-top: 10px; color: #e74c3c; font-weight: 600;">Drop ${nextStandard.improvement.toFixed(2)}s</p>
                    </div>
                    ` : `
                    <div class="stat-card">
                        <h3>Achievement</h3>
                        <div class="value">üèÜ</div>
                        <p style="margin-top: 10px; color: #27ae60;">AAAA Standard!</p>
                    </div>
                    `}
                </div>
                
                <h3 style="margin: 30px 0 20px 0;">All Standards for ${event} (${course})</h3>
                <table class="records-table">
                    <thead>
                        <tr>
                            <th>Level</th>
                            <th>Time</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            ['AAAA', 'AAA', 'AA', 'A', 'BB', 'B'].forEach(level => {
                const time = standards[level];
                const achieved = personalBest.time <= time;
                html += `
                    <tr style="${achieved ? 'background: #d4edda;' : ''}">
                        <td><span class="standard-badge standard-${level}">${level}</span></td>
                        <td><strong>${formatTime(time)}</strong></td>
                        <td>${achieved ? '‚úÖ Achieved' : `‚è±Ô∏è Need ${(personalBest.time - time).toFixed(2)}s drop`}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            content.innerHTML = html;
        }

        function updateHistory() {
            const eventFilter = document.getElementById('historyEvent').value;
            const courseFilter = document.getElementById('historyCourse').value;
            const content = document.getElementById('historyContent');
            
            let filteredSwims = swims.filter(s => {
                return (!eventFilter || s.event === eventFilter) &&
                       (!courseFilter || s.course === courseFilter);
            });
            
            filteredSwims.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (filteredSwims.length === 0) {
                content.innerHTML = '<div class="empty-state"><p>No swim times recorded yet.</p></div>';
                return;
            }
            
            content.innerHTML = filteredSwims.map(swim => {
                const standard = getStandard(swim.course, swim.event, swim.time);
                const standardBadge = standard ? 
                    `<span class="standard-badge standard-${standard}">${standard}</span>` : '';
                
                return `
                    <div class="swim-entry">
                        <div class="swim-entry-info">
                            <strong>${swim.event} - ${swim.course}</strong>
                            <div style="color: #666; margin-top: 5px;">
                                ${formatTime(swim.time)} ${standardBadge} | ${swim.meetName} | ${new Date(swim.date).toLocaleDateString()}
                            </div>
                        </div>
                        <button class="delete-btn" onclick="deleteSwim(${swim.id})">Delete</button>
                    </div>
                `;
            }).join('');
        }

        function deleteSwim(id) {
            if (confirm('Are you sure you want to delete this swim time?')) {
                swims = swims.filter(s => s.id !== id);
                localStorage.setItem('swimData', JSON.stringify(swims));
                populateEventFilters();
                updateProgressCharts();
                updateRecords();
                updateHistory();
            }
        }
    </script>
</body>
</html>
